<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>SC1 Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../data.js"></script>
</head>

<body class="bg-[#0A2240] flex justify-center py-10">
<div id="app" class="rounded-2xl w-1/2 p-6"></div>

<script>

    //Quiz input

    const quiz = updatedQuizQuestions.find(set => set.level === "SC1" && set.topic === "loops")


    //state management

    const app = document.getElementById("app");

    let answers = quiz.questions.map(() => "");
    let shuffledOptions = quiz.questions.map(q =>
        shuffleArray(q.options)
    );
    let submitted = false;
    let score = 0;

    //functions

    function shuffleArray(array) {
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i],
                arr[j]] = [arr[j],
                arr[i]];
        }
        return arr;
    }

    //rendering

    function render() {
        app.innerHTML = `
          <img src="../DMLogo_White.png" class="w-72 mx-auto  my-8" /><h1 class="mb-8 text-center text-white text-3xl font-bold">
            Test yourself on ${quiz.topic} in ${quiz.level}!
          </h1>

          ${quiz.questions.map(renderQuestion).join("")}

          ${
            submitted
                ? `<button
                  class="px-8 w-full bg-[#939598] py-4 rounded-xl text-white"
                  onclick="resetQuiz()"
                >
                  Reset
                </button>`
                : `<button
                  class="px-8 w-full py-4 bg-[#FF5100] rounded-xl text-white"
                  onclick="submitQuiz()"
                >
                  Submit
                </button>`
        }

          ${
            submitted
                ? `<p class="text-3xl text-center text-white my-8">
                  You scored ${score} out of ${quiz.questions.length}!
                </p>`
                : ""
        }
        `;
    }

    function renderQuestion(question, index) {

        return `
          <div class="space-y-6 bg-white rounded-xl p-6 mb-4">
            <p class="font-bold text-xl">
              ${index + 1}. ${question.question}
            </p>
            ${question.image ? `<img class="max-w-full" src="${question.image}" alt=""> ` : ""}


            <div class="grid grid-cols-2 gap-4">
              ${shuffledOptions[index]
            .map(option => renderOption(option, question.correctAnswer, index))
            .join("")}
            </div>
          </div>
        `;
    }

    function renderOption(option, correctAnswer, index) {
        let classes =
            "border border-[#939598] rounded-lg p-4";

        if (!submitted) {
            classes += " cursor-pointer hover:bg-[#0A2240]/20";
        }

        if (answers[index] === option) {
            classes += " bg-[#0A2240]/40";
        }

        if (submitted && answers[index] === option) {
            classes +=
                option === correctAnswer
                    ? " bg-green-500"
                    : " bg-red-500";
        }

        return `
          <div
            class="${classes}"
            onclick="selectAnswer(${index}, '${option.replace(/'/g, "\\'")}')"
          >
            ${option}
          </div>
        `;
    }

    //actions

    function selectAnswer(index, option) {
        if (submitted) return;
        answers[index] = option;
        render();
    }

    function submitQuiz() {
        submitted = true;
        score = 0;

        quiz.questions.forEach((q, i) => {
            if (answers[i] === q.correctAnswer) score++;
        });

        render();
    }

    function resetQuiz() {
        submitted = false;
        score = 0;
        answers = quiz.questions.map(() => "");
        shuffledOptions = quiz.questions.map(q =>
            shuffleArray(q.options)
        );
        render();
    }

    render();
</script>
</body>
</html>